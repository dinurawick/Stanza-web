"use strict";(self.webpackJsonp__wix_thunderbolt_app=self.webpackJsonp__wix_thunderbolt_app||[]).push([[3993],{2219:(e,t,a)=>{a.r(t),a.d(t,{PasswordProtectedPageApiSymbol:()=>l.De,site:()=>D});var o=a(77748),r=a(87711),s=a(32777),i=a(20590),n=a(32166),p=a(75396),d=a(10553),l=a(91994),c=a(66397);function u(e){return(e.split("/").pop()||"").split(".")[0]}function h({isCloseable:e,onCloseCallback:t,onSubmitCallback:a}){return{errorCode:0,isCloseable:e,onCloseDialogCallback:t,onSubmitCallback:a}}function m(e,t,a,o){return{prompt:async function(r){t.update({[e]:{translations:o,...r}}),await a.addComponentToDynamicStructure(e,{componentType:"EnterPasswordDialog",components:[]})},hide:function(){a.removeComponentFromDynamicStructure(e)},displayError:function(a){t.update({[e]:{errorCode:a}})},hideError:function(){t.update({[e]:{errorCode:0}})}}}var b=a(63386),w=a(15772),P=a(73699),f={},g={};function _(e){return(0,w.O2)(Object.assign(e,{domainToMappings:{"api._api_base_domain_":[{srcPath:"/wix-public-html-info-webapp",destPath:""}],"site-pages._base_domain_":[{srcPath:"/wix-public-html-info-webapp/api/resolve_protected_page_urls",destPath:"/api/resolve_protected_page_urls"},{srcPath:"/_api/wix-public-html-info-webapp/resolve_protected_page_urls",destPath:"/api/resolve_protected_page_urls"},{srcPath:"/_api/wix-public-html-info-webapp/published-site-details",destPath:"/v1/published-site-details"},{srcPath:"/_api/wix-public-html-info-webapp/resolve-protected-pages",destPath:"/v1/resolve-protected-pages"}],"editor._base_domain_":[{srcPath:"/_api/wix-public-html-info-webapp/v1/published-site-details",destPath:"/v1/published-site-details"}],"blocks._base_domain_":[{srcPath:"/_api/wix-public-html-info-webapp/v1/published-site-details",destPath:"/v1/published-site-details"}],"create.editorx":[{srcPath:"/_api/wix-public-html-info-webapp/v1/published-site-details",destPath:"/v1/published-site-details"}],_:[{srcPath:"/_api/wix-public-html-info-webapp/resolve-protected-pages",destPath:"/v1/resolve-protected-pages"}]}}))}var v=a(65064);class C extends Error{constructor(e){super(e),this.name="PasswordVerificationError"}}function S(e,t,a){const o=(0,v.u)({isSSR:!1}),r={PAGE_ACCESS_DENIED:-17005},s=-19970;async function i(t){try{const a=await o.request(function(e){var t=(0,P.d)(f,{}),a=t.toJSON,o=t.fromJSON,r=(0,P.d)(g,{}).fromJSON;function s(t){var o=t.host,s=a(e);return{entityFqdn:"wix.document_management.public_editor_info.v1.published_site_details",method:"POST",methodFqn:"com.wixpress.html.info.rpc.PublishedSiteDetailsService.ResolveProtectedPagesJsonFilename",url:_({protoPath:"/v1/resolve-protected-pages",data:s,host:o}),data:s,transformResponse:r}}return s.fromReq=o,s.__isAmbassador=!0,s}(t),{signedInstance:e});return{success:!0,errorCode:0,pagesMap:a.data.pagesJsonFilename.reduce(((e,t)=>(e[t.pageId]=t.jsonFilename,e)),{})}}catch(e){const t=e.response?.data?.details?.applicationError?.code,o=r[t]??s;return o===s&&a.captureError(new C("Failed to verify site/page password"),{tags:{feature:"feature-password-protected-page",method:"doVerify"},extra:{error:e,requestId:e.response?.headers?.["x-wix-request-id"]}}),{success:!1,errorCode:o,pagesMap:{}}}}return{verifyPagePassword:(e,t)=>i({pageId:e,password:t}),verifySitePassword:e=>i({password:e})}}const y=(0,o.Og)([r.Ji,r.eZ,s.F,(0,o.KT)(i.YG,l.UU),n.TQ,p.t7,(0,o.KT)(i._K,l.UU),b.i$,d.n,n.Ht],((e,t,a,o,r,s,{pagePasswordDialogTranslations:i,sitePasswordDialogTranslations:n},p,d,b)=>{let w,P=!1;const f={propsStore:e,structureApi:t,fetchApi:a,siteFeatureConfig:o,viewerModel:r,currentRouteInfo:s,api:S(p.getAppInstanceByAppDefId("22bef345-3c5b-4c18-b782-74d4085112ff")??"",0,b)},g=function({propsStore:e,structureApi:t,fetchApi:a,siteFeatureConfig:o,currentRouteInfo:r,viewerModel:s},i){const{siteRevision:n,metaSiteId:p,siteId:d}=s.site,b=`${o.protectedPageResolverUrl}?siteRevision=${n}`,w=m(l.RG,e,t,i);return{prompt:e=>(w.hide(),new Promise((async t=>{const s=r.isLandingOnProtectedPage(),i=o.homePageId===e,n=h({isCloseable:!s||!i,onCloseCallback(){w.hide(),s&&t({authenticationResult:{reason:c.qd.CANCELED},authorizedPagesMap:{}})},async onSubmitCallback(o){w.hideError();const r=await a.envFetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:o,pageId:e,metaSiteId:p,siteId:d})}).then((e=>e.json()));r.errorCode?w.displayError(r.errorCode):t({authorizedPagesMap:{[e]:u(r.payload.urls[0])},onProtectedPageNavigationComplete:w.hide})}});await w.prompt(n)})))}}(f,i),_=function({propsStore:e,structureApi:t,api:a},o){const r=m(l.VX,e,t,o);return{prompt:()=>(r.hide(),new Promise((async e=>{const t=h({isCloseable:!1,onCloseCallback(){},async onSubmitCallback(t){r.hideError();const o=await a.verifySitePassword(t);o.errorCode?r.displayError(o.errorCode):e({authorizedPagesMap:o.pagesMap,onComplete:r.hide})}});await r.prompt(t)})))}}(f,n);function v(e,t){return new Promise((async a=>{const o=()=>t().then(a);e?w=o:await o()}))}return{appDidMount:()=>{w&&(w(),w=null),P=!0},promptPagePasswordDialog:e=>v(s.isLandingOnProtectedPage()&&!P,(()=>g.prompt(e))),promptSitePasswordDialog:()=>v(!P,(()=>_.prompt()))}}));var x=a(16537);const D=e=>{e(x.$.AppDidMountHandler,l.De).to(y)}}}]);
//# sourceMappingURL=assets/static.parastorage.com/services/wix-thunderbolt/dist/group_19.d9238efa.chunk.min.js.map